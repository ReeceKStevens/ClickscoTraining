<!DOCTYPE html>
<html lan="en">
  <head>
    <!--Variable title based on server, will display current server-->
    <title>Server{{ server }} Status</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
  </head>
  <body>
    <nav class="navbar navbar-expand-sm bg-light">
      <!-- Links -->
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="http://127.0.0.1:5000/#">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="http://127.0.0.1:5000/ServerA/view">Server A</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="http://127.0.0.1:5000/ServerB/view">Server B</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="http://127.0.0.1:5000/ServerC/view">Server C</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="http://127.0.0.1:5000/ServerD/view">Server D</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="http://127.0.0.1:5000/ServerE/view">Server E</a>
        </li>
      </ul>
    </nav>

    <div class="container">
      <!--Spans have been embeded within headings so that information can be injected
      later, span used over div to prevent new line on content-->
      <div class="row">
        <h1>Server {{ server }} </h1>
      </div>
      <div class="row">
        <h3>This Server has Posted <span id = "Wins"></span> Ads<h3/>
      </div>
      <div class="row">
        <h3>Server Strategy: <span id = "Strategy"></span></h3>
      </div>
      <div class="row">
        <h3>Server Funds: <span id = "Budget"></span>p<h3/>
      </div>
      <div class="row">
        <h3>Topping Up Every <span id = "Interval"></span> Seconds</h3>
      </div>
      <canvas id="myChart"></canvas>
    </div>
  </body>
  <script src="{{ url_for('static', filename='node_modules/chart.js/dist/Chart.js') }}"></script>
  <script>
    var ctx = document.getElementById("myChart");
    var myChart = new Chart(ctx, {
        type: 'bar',
        data:{
          labels:[],
          datasets: [{
            label: 'Winning Bid',
            data: []
          }]
        },
        options: {
            //responsive: false,
            maintainAspectRatio: false,
            scales: {
                yAxes: [{
                    ticks: {
                        max: 50,
                        beginAtZero:true
                    }
                }]
            }
        }
    });
  </script>
  <!-- Source for jquery scripts -->
  <script type=text/javascript>
    //Poll request runs on a 1 second interval to keep constant updates
    setInterval(function updatePage(){
      //Post uses server variable to determine correct server to post to
      $.post('http://127.0.0.1:5000/Server{{ server }}/update',
      //When we recieve a URL response, set it as the source of the second image
      function(res){
        //response is recieved as string, split it back into list
        var formattedResponse = res.split(",");
        //set span elements using post response
        $('#Wins').text(formattedResponse[0]),
        $('#Strategy').text(formattedResponse[1]),
        $('#Budget').text(formattedResponse[2]),
        $('#Interval').text(formattedResponse[3])
        var i;
        var offers = formattedResponse. slice(4);
        for (i = 0; i < offers.length; i++) {
          myChart.data.labels[i] = ("Bid #" + String(i+1));
          myChart.data.datasets[0].data[i] = offers[i];
        }
        myChart.update();
      });
    }, 1000);
  </script>
</html>
